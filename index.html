<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event Timers — Enxtinct & Galactic</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7dd3fc;--accent2:#c084fc;--muted:#9aa4b2;--glass:rgba(255,255,255,0.04)}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071024 0%, #051426 100%);color:#e6eef6;padding:24px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:28px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0;font-size:20px;letter-spacing:0.2px}
    p.lead{color:var(--muted);margin:6px 0 18px}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media (max-width:760px){.grid{grid-template-columns:1fr;}}

    .panel{background:var(--card);padding:18px;border-radius:10px;border:1px solid var(--glass)}

    .countdown{font-size:32px;margin-top:6px;font-weight:700;text-align:center}
    .status{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(125,211,252,0.12);color:var(--accent);font-weight:700;margin-left:8px;font-size:13px}
    .status2{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(192,132,252,0.12);color:var(--accent2);font-weight:700;margin-left:8px;font-size:13px}

    .note{margin-top:8px;color:var(--muted);font-size:13px;text-align:center}

    #settingsPanel{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--glass);z-index:1000;width:280px}
    #settingsPanel h2{margin-top:0}
    #overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:900}
    .btn{background:var(--accent);color:#022;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;margin-top:10px}
    #settingsBtn{margin-bottom:16px;cursor:pointer;background:transparent;border:1px solid rgba(255,255,255,0.2);padding:6px 10px;border-radius:8px;color:var(--muted)}
  </style>
</head>
<body>
  <main class="card" role="main">
    <header>
      <h1>Event Timers — Enxtinct & Galactic</h1>
      <p class="lead">Countdowns and notifications for:<br>
      • <strong>Enxtinct Event</strong>: every 2 hours<br>
      • <strong>Galactic Event</strong>: every 1 hour</p>
      <button id="settingsBtn">⚙️ Settings</button>
    </header>

    <section class="grid">
      <div class="panel">
        <h2>Enxtinct Event</h2>
        <div style="display:flex;justify-content:center;align-items:center;gap:10px;margin-top:12px">
          <div class="countdown" id="enxtinctCountdown">—</div>
          <div id="enxtinctStatus" class="status" style="display:none">LIVE</div>
        </div>
        <div class="note" id="enxtinctExact">—</div>
      </div>

      <div class="panel">
        <h2>Galactic Event</h2>
        <div style="display:flex;justify-content:center;align-items:center;gap:10px;margin-top:12px">
          <div class="countdown" id="galacticCountdown">—</div>
          <div id="galacticStatus" class="status2" style="display:none">LIVE</div>
        </div>
        <div class="note" id="galacticExact">—</div>
      </div>
    </section>
  </main>

  <div id="overlay"></div>
  <div id="settingsPanel">
    <h2>Notification Settings</h2>
    <label><input type="checkbox" id="notifyEnxtinct" checked> Enxtinct Event</label><br>
    <label><input type="checkbox" id="notifyGalactic" checked> Galactic Event</label><br>
    <label><input type="checkbox" id="notifySound" checked> Play klingeltone sound</label><br>
    <button class="btn" id="saveSettings">Save</button>
  </div>

  <audio id="klingelSound">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

  <script>
    const pad = n => String(n).padStart(2,'0');

    function floorToBoundary(d, intervalHours){
      const copy = new Date(d.getTime());
      const h = copy.getHours();
      const floored = Math.floor(h/intervalHours)*intervalHours;
      copy.setHours(floored,0,0,0);
      return copy;
    }

    function computeNextStart(now, intervalHours){
      const last = floorToBoundary(now, intervalHours);
      if(now.getTime() < last.getTime()) return {startingNow:false, next:last};
      if(now.getHours()%intervalHours===0 && now.getMinutes()===0 && now.getSeconds()===0){
        return {startingNow:true, next:new Date(last.getTime()+intervalHours*3600000)};
      }
      return {startingNow:false, next:new Date(last.getTime()+intervalHours*3600000)};
    }

    function formatLocal(d){
      return d.toLocaleString(undefined,{hour:'2-digit',minute:'2-digit'});
    }

    const enxtinctCountdown=document.getElementById('enxtinctCountdown');
    const enxtinctExact=document.getElementById('enxtinctExact');
    const enxtinctStatus=document.getElementById('enxtinctStatus');
    const galacticCountdown=document.getElementById('galacticCountdown');
    const galacticExact=document.getElementById('galacticExact');
    const galacticStatus=document.getElementById('galacticStatus');

    const klingelSound=document.getElementById('klingelSound');

    let settings={notifyEnxtinct:true,notifyGalactic:true,notifySound:true};

    function loadSettings(){
      const saved=localStorage.getItem('eventSettings');
      if(saved) settings=JSON.parse(saved);
      document.getElementById('notifyEnxtinct').checked=settings.notifyEnxtinct;
      document.getElementById('notifyGalactic').checked=settings.notifyGalactic;
      document.getElementById('notifySound').checked=settings.notifySound;
    }

    function saveSettings(){
      settings={
        notifyEnxtinct:document.getElementById('notifyEnxtinct').checked,
        notifyGalactic:document.getElementById('notifyGalactic').checked,
        notifySound:document.getElementById('notifySound').checked
      };
      localStorage.setItem('eventSettings',JSON.stringify(settings));
      closeSettings();
    }

    function notifyUser(title,message){
      alert(message);
      if(Notification.permission==='granted'){
        new Notification(title,{body:message});
      }
    }

    let lastEnxtinctStart=null;
    let lastGalacticStart=null;

    function updateAll(){
      const now=new Date();

      // Enxtinct (2h)
      const enx=computeNextStart(now,2);
      const diffEnx=enx.next.getTime()-now.getTime();
      if(enx.startingNow){
        enxtinctStatus.style.display='inline-block';
        enxtinctStatus.textContent='STARTING NOW';
        if(!lastEnxtinctStart || lastEnxtinctStart.getTime()!==enx.next.getTime()-2*3600000){
          lastEnxtinctStart=new Date(enx.next.getTime()-2*3600000);
          if(settings.notifyEnxtinct){
            if(settings.notifySound) klingelSound.play();
            notifyUser('Enxtinct Event','The Enxtinct event is starting now!');
          }
        }
      } else {
        enxtinctStatus.style.display='none';
      }
      const remEnx=Math.max(0,Math.floor(diffEnx/1000));
      enxtinctCountdown.textContent=pad(Math.floor(remEnx/3600))+':'+pad(Math.floor((remEnx%3600)/60))+':'+pad(remEnx%60);
      enxtinctExact.textContent='Next start at '+formatLocal(enx.next);

      // Galactic (1h)
      const gal=computeNextStart(now,1);
      const diffGal=gal.next.getTime()-now.getTime();
      if(gal.startingNow){
        galacticStatus.style.display='inline-block';
        galacticStatus.textContent='STARTING NOW';
        if(!lastGalacticStart || lastGalacticStart.getTime()!==gal.next.getTime()-3600000){
          lastGalacticStart=new Date(gal.next.getTime()-3600000);
          if(settings.notifyGalactic){
            if(settings.notifySound) klingelSound.play();
            notifyUser('Galactic Event','The Galactic event is starting now!');
          }
        }
      } else {
        galacticStatus.style.display='none';
      }
      const remGal=Math.max(0,Math.floor(diffGal/1000));
      galacticCountdown.textContent=pad(Math.floor(remGal/3600))+':'+pad(Math.floor((remGal%3600)/60))+':'+pad(remGal%60);
      galacticExact.textContent='Next start at '+formatLocal(gal.next);
    }

    // Settings UI
    const settingsBtn=document.getElementById('settingsBtn');
    const overlay=document.getElementById('overlay');
    const panel=document.getElementById('settingsPanel');
    document.getElementById('saveSettings').addEventListener('click',saveSettings);

    function openSettings(){overlay.style.display='block';panel.style.display='block';}
    function closeSettings(){overlay.style.display='none';panel.style.display='none';}

    settingsBtn.addEventListener('click',()=>{loadSettings();openSettings();});
    overlay.addEventListener('click',closeSettings);

    // Ask permission for notifications
    if("Notification" in window && Notification.permission!=='granted' && Notification.permission!=='denied'){
      Notification.requestPermission();
    }

    loadSettings();
    updateAll();
    setInterval(updateAll,1000);
  </script>
</body>
</html>
